{% extends 'base.html' %}
{% load static %}

{% block cabecera %}<link rel="stylesheet" href="{% static 'css/style_book_list.css' %}"/>{% endblock %}
{% block title %}Mis reservas / Citra{% endblock %}
{% block contenido %}
<main class="l-main">    
    <div class="container">
        <div class="row">
            <h4 class="section-title mt-lg-2 ">Mis reservas</h4>
        </div>
        {% for user,factoresConfianza in booking_owner.items %}
        <div class="row">  
            <h1> {{user.name}}, total a pagar {{user.phoneNumber}}</h1>                          
            {% for book,factor in factoresConfianza.items %}
            <div class="col-lg-3 col-md-6 mb-4 mb-lg-0">
                <!-- Card-->
                <div class="card rounded shadow-sm border-0 product">
                    <div class="card-body p-4"><img src="{{book.product.picture.url}}" alt="" class="img-fluid d-block mx-auto mb-3">
                        <h4 class="card-title" style="text-align:center;">Tienda: {{book.product.shop.name}}</h4>
                        <p class="product__name" style="text-align: center;" > Nombre Producto: <b>{{book.product.name}} </b> </p>
                        <span class="product__price"> Cantidad Reservada: {{book.quantity}} </span>
                        <span class="product__price"> Precio del Producto Reservado: {{book.title}} </span>
                        <br>
                        <span class="product__price"> Nombre del usuario: {{book.user.person.name}} </span>
                        <br>
                        <span class="product__price">El usuario tiene que recogerlo antes de las: {{book.endDate|date:'d/m/Y H:i'}} </span>
                            <img style = "width:40px;heigth:40px;" src="
                                {% if factor == 0 %}
                                    {% static 'images/pregunta.png' %}
                                {% elif factor == 1 %}
                                    {% static 'images/max.png' %}
                                {% elif factor == 2 %}
                                    {% static 'images/intermedio.png' %}
                                {% elif factor == 3 %}
                                    {% static 'images/min.png' %}
                                {% endif %}">
                            </img>
                        </span>
                        {% if book.isAccepted == 0 %}
                        <button type="button" class="button-light" onclick="aceptar({{book.id}})">Aceptar</button>
                        <button type="button" class="button-light" onclick="rechazar({{book.id}})">Rechazar</button>
                        <button type="button" class="btn btn-outline-warning"><a style="text-decoration: none;" class="button-light" href="{{book.id}}/report"> Reportar </a></button>
                        {% endif %}
                        {% if book.isAccepted == 1 %}
                        <button type="button" class="btn btn-outline-warning" onclick="rechazar({{book.id}})"><a style="text-decoration: none;" class="button-light">Recogido</a></button>
                        <button type="button" class="btn btn-outline-warning"><a style="text-decoration: none;" class="button-light" href="{{book.id}}/report"> Reportar </a></button>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% empty %}
            {% endfor %}

        </div>
        {% endfor %}
    </div>
</main>

<script>
    function aceptar(id) {
        data = {
            id: id,
            csrfmiddlewaretoken: '{{ csrf_token }}',
        }
        $.ajax({
            url: 'acceptbookings/',
            data: data,
            type: 'POST',
            success: function (data) {
                console.log(window.location.origin)
                console.log(window.location.origin + data.url)
                window.location.replace(window.location.origin + data.url);
            }
        });
    }
    function rechazar(id) {
        data = {
            id: id,
            csrfmiddlewaretoken: '{{ csrf_token }}'
        }
        $.ajax({
            url: 'deletebooking/',
            data: data,
            type: 'POST',
            success: function (data) {
                console.log(window.location.origin)
                console.log(window.location.origin + data.url)
                window.location.replace(window.location.origin + data.url);
            }
        });
    }
</script>

{% endblock %}